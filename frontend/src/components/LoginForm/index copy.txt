import { Formik, Form, FormikProps, Field, FormikActions } from "formik";
import React from "react";
import { connect } from "react-redux";
import { submitLoginAsync } from "../../actions/login/types";
import { Action } from "redux";

// PLAIN =====================================================================

interface LoginFormValues {
  username: string;
  password: string;
}

interface LoginFormOtherProps {
  message: string;
}

export interface LoginFormProps {}

export interface LoginFormState {}

const LoginForm = (
  props: //LoginFormOtherProps &
  FormikProps<LoginFormValues>
) => {
  const { touched, errors, isSubmitting, message } = props;
  return (
    <Form>
      <h1>{message}</h1>
      <Field type="username" name="username" />
      {touched.username && errors.username && <div>{errors.username}</div>}

      <Field type="password" name="password" />
      {touched.password && errors.password && <div>{errors.password}</div>}

      <button type="submit" disabled={isSubmitting}>
        Submit
      </button>
    </Form>
  );
};

// WRAPPER ========================================================

interface OnSubmitEnabledProps {
  onSubmit: (
    values: LoginFormValues,
    formikActions: FormikActions<LoginFormValues>
  ) => void;
}

interface DispatchProps extends OnSubmitEnabledProps {}

interface LoginFormWrapperProps
  extends OnSubmitEnabledProps,
    LoginFormOtherProps {}

function mapDispatchToProps(dispatch: Redux.Dispatch<Action>): DispatchProps {
  return {
    onSubmit: (
      values: LoginFormValues,
      formikActions: FormikActions<LoginFormValues>
    ) =>
      dispatch(
        submitLoginAsync.request({
          username: values.username,
          password: values.password
        })
      )
  };
}

const initialValues: LoginFormValues = {
  username: "",
  password: ""
};

const LoginFormWrapper = (wrapperProps: LoginFormWrapperProps) => (
  <Formik
    initialValues={initialValues}
    // validationSchema={validationSchema}
    validateOnBlur={false}
    validateOnChange={false}
    onSubmit={wrapperProps.onSubmit}
    render={props => <LoginForm {...props} />}
  />
);

export const Login = connect<{}, DispatchProps, LoginFormWrapperProps, {}>(
  null,
  mapDispatchToProps
)(LoginFormWrapper);
